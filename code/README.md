# Source code for producing the results and figures

The code is divided between Python modules in `tesseroid-density`, Jupyter
notebooks in `notebooks`, and analysis scripts in `scripts`.
The modules implement the methodology and code that is reused in different applications.
This code is tested using `pytest` with the test code in `tests`.

The `Makefile` automates all processes related to executing code.
Run the following to perform all actions from building the software to
generating the final figures:

    make all


## Python package

The `tesseroid-density` package allows to compute the gravity fields generated
by any tesseroids with an arbitrary continuous density function.

The tesseroid geometry must be generated through the
`fatiando.mesher.Tesseroid` class, or a mesh of tesseroids with
`fatiando.mesher.TesseroidMesh`. We can incorporate a density
function to every tesseroid by defining a regular Python function with a single
`height` argument (float or numpy 1d array) that returns a float.


## Building, testing, and linting

Use the `Makefile` to build, test, and lint the software:

* Build and install:

        make build

* Run the static checks using flake8 and pylint:

        make check

* Run the tests in `tests` and doctests in docstrings:

        make test

* Calculate the test coverage of the main Python code (not including the
  notebooks):

        make coverage


## Scripts

Inside `scripts` we can find the Python scripts that create the results and figures
shown on the manuscript.

- `density-based-discretization.py`: Create example figure for how the
  discretization-based algorithm works.
- `linear_density.py`: Compares the numerical results of a spherical shell with its
  analytical solution in case of a linear density in depth. Only the adaptive
  discretization algorithm is performed.
- `grid_search.py`: Performs a grid search by comparing the numerical results of
  a spherical shell with its analytical solution in case of an exponential density. The
  grid search is done by exploring values of distance-size ratio (D) and delta ratio.
- `exponential_density.py`: Compares the numerical results of a spherical shell with its
  analytical solution in case of an exponential density in depth. It fixes the
  distance-size ratio (D) for the values obtained on the linear density case.
- `sine_density.py`: Compares the numerical results of a spherical shell with its
  analytical solution in case of a sinusoidal density in depth. The purpose of this
  comparison is only to test the behaviour of the numerical approximation even on
  a highly varying density function. These kind of density functions are not intended to
  be applied on an actual geophysical case.
- `number-of-tesseroids.py`: Compute the number of discretization the density-based
  algorithm performs for different density functions.
- `neuquen_basin.py`: Apply the new methodology to forward model the Neuquén Basin with
  an exponential increasing density in depth and compare it with the results for an
  homogeneous and a linear density.

Extra files:
- `tesseroid_model.py`: File containing useful classes for the Neuquén Basin forward
  modelling.

Directories:
- `results`: Directory where all resulting files generated by the scripts will be saved.


You can generate the results by running all scripts with:
```
make results
```
This could take a lot of time, so please be patient.

Or you can just recreate the figures with:
```
make figures
```

## Notebooks

Inside `notebooks` we can find a single notebook showing how `tesseroid_density` could
be used on forward modelling a mesh of tesseroids or a single one.

* [tesseroid_density_example.ipynb](): Shows examples on how to use the variable
  density tesseroid code to model a single tesseroid or tesseroids meshes and
  compute the gravitational fields they generate.

In order to open the notebook, run `jupyter-notebook`. It will open a new tab on your
web browser in which you can navigate and open the notebook.
If you want to obtain the same results, run the cells in order.
